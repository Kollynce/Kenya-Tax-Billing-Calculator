"use strict";(self["webpackChunksanaapesa"]=self["webpackChunksanaapesa"]||[]).push([[421],{6421:function(e,a,t){t.r(a),t.d(a,{default:function(){return M}});var r=t(6768),i=t(5130),s=t(4232);const n={class:"max-w-7xl mx-auto px-4 py-8"},l={class:"bg-gradient-to-br from-green-50 to-emerald-50 rounded-lg shadow-lg p-6"},o={class:"bg-white rounded-lg shadow p-6"},u={class:"space-y-4"},m={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},d={class:"grid grid-cols-1 md:grid-cols-2 gap-6 p-4 bg-gray-50 rounded-lg"},f={class:"grid grid-cols-1 md:grid-cols-2 gap-6 p-4 bg-gray-50 rounded-lg"},b={class:"p-4 bg-gray-50 rounded-lg"},c={class:"flex justify-end"},R={key:0,class:"mt-4 text-red-600"};function h(e,a,t,h,v,I){const g=(0,r.g2)("InputField"),p=(0,r.g2)("Button");return(0,r.uX)(),(0,r.CE)("div",n,[(0,r.Lk)("div",l,[a[14]||(a[14]=(0,r.Lk)("div",{class:"mb-8"},[(0,r.Lk)("h1",{class:"text-3xl font-bold text-gray-900"},"Tax Settings"),(0,r.Lk)("p",{class:"mt-2 text-gray-600"},"Configure tax rates and thresholds for calculations")],-1)),(0,r.Lk)("div",o,[(0,r.Lk)("form",{onSubmit:a[8]||(a[8]=(0,i.D$)(((...e)=>h.handleSubmit&&h.handleSubmit(...e)),["prevent"])),class:"space-y-8"},[(0,r.Lk)("div",null,[a[9]||(a[9]=(0,r.Lk)("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Income Tax Brackets",-1)),(0,r.Lk)("div",u,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(h.form.brackets,((e,a)=>((0,r.uX)(),(0,r.CE)("div",{key:a,class:"p-4 bg-gray-50 rounded-lg"},[(0,r.Lk)("div",m,[(0,r.bF)(g,{id:"bracketMin"+a,modelValue:e.min,"onUpdate:modelValue":a=>e.min=a,modelModifiers:{number:!0},label:"From (KES)",type:"number",error:h.bracketErrors[a]?.min,disabled:0===a},null,8,["id","modelValue","onUpdate:modelValue","label","error","disabled"]),(0,r.bF)(g,{id:"bracketMax"+a,modelValue:e.max,"onUpdate:modelValue":a=>e.max=a,modelModifiers:{number:!0},label:"To (KES)",type:"number",error:h.bracketErrors[a]?.max,placeholder:a===h.form.brackets.length-1?"No limit":"",disabled:a===h.form.brackets.length-1},null,8,["id","modelValue","onUpdate:modelValue","error","placeholder","disabled"]),(0,r.bF)(g,{id:"bracketRate"+a,modelValue:e.rate,"onUpdate:modelValue":a=>e.rate=a,modelModifiers:{number:!0},label:"Rate (%)",type:"number",step:"0.01",error:h.bracketErrors[a]?.rate},null,8,["id","modelValue","onUpdate:modelValue","error"])])])))),128))])]),(0,r.Lk)("div",null,[a[10]||(a[10]=(0,r.Lk)("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"NSSF Settings",-1)),(0,r.Lk)("div",d,[(0,r.bF)(g,{id:"nssfTierIRate",modelValue:h.form.nssfTierIRate,"onUpdate:modelValue":a[0]||(a[0]=e=>h.form.nssfTierIRate=e),modelModifiers:{number:!0},label:"Tier I Rate (%)",type:"number",step:"0.01",error:h.errors.nssfTierIRate},null,8,["modelValue","error"]),(0,r.bF)(g,{id:"nssfTierIIRate",modelValue:h.form.nssfTierIIRate,"onUpdate:modelValue":a[1]||(a[1]=e=>h.form.nssfTierIIRate=e),modelModifiers:{number:!0},label:"Tier II Rate (%)",type:"number",step:"0.01",error:h.errors.nssfTierIIRate},null,8,["modelValue","error"]),(0,r.bF)(g,{id:"nssfTierILimit",modelValue:h.form.nssfTierILimit,"onUpdate:modelValue":a[2]||(a[2]=e=>h.form.nssfTierILimit=e),modelModifiers:{number:!0},label:"Tier I Monthly Limit (KES)",type:"number",error:h.errors.nssfTierILimit},null,8,["modelValue","error"]),(0,r.bF)(g,{id:"nssfTierIILimit",modelValue:h.form.nssfTierIILimit,"onUpdate:modelValue":a[3]||(a[3]=e=>h.form.nssfTierIILimit=e),modelModifiers:{number:!0},label:"Tier II Monthly Limit (KES)",type:"number",error:h.errors.nssfTierIILimit},null,8,["modelValue","error"])])]),(0,r.Lk)("div",null,[a[11]||(a[11]=(0,r.Lk)("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"SHIF Settings",-1)),(0,r.Lk)("div",f,[(0,r.bF)(g,{id:"shifRate",modelValue:h.form.shifRate,"onUpdate:modelValue":a[4]||(a[4]=e=>h.form.shifRate=e),modelModifiers:{number:!0},label:"SHIF Rate (%)",type:"number",step:"0.01",error:h.errors.shifRate},null,8,["modelValue","error"]),(0,r.bF)(g,{id:"shifMinContribution",modelValue:h.form.shifMinContribution,"onUpdate:modelValue":a[5]||(a[5]=e=>h.form.shifMinContribution=e),modelModifiers:{number:!0},label:"Minimum Monthly Contribution (KES)",type:"number",error:h.errors.shifMinContribution},null,8,["modelValue","error"]),(0,r.bF)(g,{id:"shifMaxContribution",modelValue:h.form.shifMaxContribution,"onUpdate:modelValue":a[6]||(a[6]=e=>h.form.shifMaxContribution=e),modelModifiers:{number:!0},label:"Maximum Monthly Contribution (KES)",type:"number",error:h.errors.shifMaxContribution},null,8,["modelValue","error"])])]),(0,r.Lk)("div",null,[a[12]||(a[12]=(0,r.Lk)("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Housing Levy Settings",-1)),(0,r.Lk)("div",b,[(0,r.bF)(g,{id:"housingLevyRate",modelValue:h.form.housingLevyRate,"onUpdate:modelValue":a[7]||(a[7]=e=>h.form.housingLevyRate=e),modelModifiers:{number:!0},label:"Housing Levy Rate (%)",type:"number",step:"0.01",error:h.errors.housingLevyRate},null,8,["modelValue","error"])])]),(0,r.Lk)("div",c,[(0,r.bF)(p,{type:"submit",variant:"kenya",loading:h.taxStore.loading,disabled:h.taxStore.loading},{default:(0,r.k6)((()=>a[13]||(a[13]=[(0,r.eW)(" Save Changes ")]))),_:1},8,["loading","disabled"])]),h.taxStore.error?((0,r.uX)(),(0,r.CE)("div",R,(0,s.v_)(h.taxStore.error),1)):(0,r.Q3)("",!0)],32)])])])}t(8111),t(7588);var v=t(144),I=(t(1701),t(657)),g=t(538),p=t(143);const x=(0,I.nY)("tax",{state:()=>({taxRates:null,settings:null,currentCalculation:null,calculationHistory:[],loading:!1,error:null}),actions:{async initialize(){await Promise.all([this.loadTaxRates(),this.loadSettings()])},async loadTaxRates(){try{this.loading=!0;const e=(new Date).getFullYear(),a=await(0,g.tz)(e);a&&(this.taxRates={...a,shifRate:Number(a.shifRate||.0275),nssfTierIRate:Number(a.nssfTierIRate||.06),nssfTierIIRate:Number(a.nssfTierIIRate||.06),vatRate:Number(a.vatRate||.16),housingLevyRate:Number(a.housingLevyRate||.015),personalRelief:Number(a.personalRelief||28800),brackets:(a.brackets||[]).map((e=>({min:Number(e.min||0),max:null===e.max?null:Number(e.max||0),rate:Number(e.rate||0)})))})}catch(e){throw this.error="Failed to load tax rates",e}finally{this.loading=!1}},async loadSettings(){try{this.loading=!0;const e=await(0,g.HH)();this.settings=e}catch(e){throw this.error="Failed to load tax settings",e}finally{this.loading=!1}},async calculateTax({annualIncome:e,includeNSSF:a=!0,includeSHIF:t=!0}){try{if(!this.taxRates)throw new Error("Tax rates not loaded");const r=(0,p.zZ)({annualIncome:e,includeNSSF:a,includeSHIF:t,taxRates:this.taxRates,personalRelief:this.settings?.personalReliefEnabled?this.taxRates.personalRelief:0}),i=(0,p.zD)(r);return this.currentCalculation=i,i}catch(r){throw this.error="Failed to calculate tax",r}},async saveCalculation(e,a){if(!a)throw new Error("User must be logged in to save calculations");await(0,g.UE)(a,e)},async loadCalculationHistory(e){if(e)try{this.loading=!0;const a=await(0,g.Ak)(e);this.calculationHistory=a}catch(a){throw this.error="Failed to load calculation history",a}finally{this.loading=!1}else this.calculationHistory=[]},async updateRates(e){try{this.loading=!0;const a={...e,shifRate:Number(e.shifRate||0),nssfTierIRate:Number(e.nssfTierIRate||0),nssfTierIIRate:Number(e.nssfTierIIRate||0),vatRate:Number(e.vatRate||0),housingLevyRate:Number(e.housingLevyRate||0),personalRelief:Number(e.personalRelief||0),brackets:(e.brackets||[]).map((e=>({min:Number(e.min||0),max:null===e.max?null:Number(e.max||0),rate:Number(e.rate||0)})))};await(0,g.EJ)(a),this.taxRates=a}catch(a){throw this.error="Failed to update tax rates",a}finally{this.loading=!1}},clearCurrentCalculation(){this.currentCalculation=null},clearError(){this.error=null}},getters:{isInitialized:e=>!!e.taxRates&&!!e.settings,currentTaxYear:e=>e.taxRates?.year,personalRelief:e=>e.taxRates?.personalRelief||0,taxBrackets:e=>e.taxRates?.brackets||[],isNSSFEnabled:e=>e.settings?.nssfEnabled,isSHIFEnabled:e=>e.settings?.shifEnabled,isPersonalReliefEnabled:e=>e.settings?.personalReliefEnabled}});var y=t(513),T=t(8012),L={name:"SettingsView",components:{InputField:y.A,Button:T.A},setup(){const e=x(),a=(0,v.KR)({}),t=(0,v.KR)([]),i=(0,v.KR)({brackets:[{min:0,max:24e3,rate:10},{min:24001,max:32333,rate:25},{min:32334,max:5e5,rate:30},{min:500001,max:8e5,rate:32.5},{min:800001,max:null,rate:35}],shifRate:2.75,shifMinContribution:300,shifMaxContribution:1e3,nssfTierIRate:6,nssfTierIIRate:6,nssfTierILimit:6e3,nssfTierIILimit:12e3,housingLevyRate:1.5,personalRelief:28800,vatRate:16}),s=async()=>{try{if(await e.loadTaxRates(),e.taxRates){const a=e.taxRates;i.value={brackets:a.brackets||i.value.brackets,shifRate:"number"===typeof a.shifRate?100*a.shifRate:i.value.shifRate,shifMinContribution:a.shifMinContribution||i.value.shifMinContribution,shifMaxContribution:a.shifMaxContribution||i.value.shifMaxContribution,nssfTierIRate:"number"===typeof a.nssfTierIRate?100*a.nssfTierIRate:i.value.nssfTierIRate,nssfTierIIRate:"number"===typeof a.nssfTierIIRate?100*a.nssfTierIIRate:i.value.nssfTierIIRate,nssfTierILimit:a.nssfTierILimit||i.value.nssfTierILimit,nssfTierIILimit:a.nssfTierIILimit||i.value.nssfTierIILimit,housingLevyRate:a.housingLevyRate||i.value.housingLevyRate,personalRelief:a.personalRelief||i.value.personalRelief,vatRate:"number"===typeof a.vatRate?100*a.vatRate:i.value.vatRate}}}catch(a){console.error("Error loading tax rates:",a)}},n=()=>{a.value={},t.value=[];let e=!0;return i.value.brackets.forEach(((a,r)=>{const i={};a.min<0&&(i.min="Minimum value cannot be negative",e=!1),a.max&&a.max<=a.min&&(i.max="Maximum value must be greater than minimum",e=!1),(a.rate<0||a.rate>100)&&(i.rate="Rate must be between 0 and 100",e=!1),Object.keys(i).length>0&&(t.value[r]=i)})),(i.value.shifRate<0||i.value.shifRate>100)&&(a.value.shifRate="SHIF rate must be between 0 and 100",e=!1),i.value.shifMinContribution<0&&(a.value.shifMinContribution="Minimum SHIF contribution cannot be negative",e=!1),i.value.shifMaxContribution<0&&(a.value.shifMaxContribution="Maximum SHIF contribution cannot be negative",e=!1),(i.value.nssfTierIRate<0||i.value.nssfTierIRate>100)&&(a.value.nssfTierIRate="NSSF Tier I rate must be between 0 and 100",e=!1),(i.value.nssfTierIIRate<0||i.value.nssfTierIIRate>100)&&(a.value.nssfTierIIRate="NSSF Tier II rate must be between 0 and 100",e=!1),i.value.nssfTierILimit<0&&(a.value.nssfTierILimit="NSSF Tier I limit cannot be negative",e=!1),i.value.nssfTierIILimit<0&&(a.value.nssfTierIILimit="NSSF Tier II limit cannot be negative",e=!1),(i.value.housingLevyRate<0||i.value.housingLevyRate>100)&&(a.value.housingLevyRate="Housing levy rate must be between 0 and 100",e=!1),i.value.personalRelief<0&&(a.value.personalRelief="Personal relief cannot be negative",e=!1),(i.value.vatRate<0||i.value.vatRate>100)&&(a.value.vatRate="VAT rate must be between 0 and 100",e=!1),e},l=async()=>{if(n())try{await e.updateRates({...i.value,shifRate:i.value.shifRate/100,nssfTierIRate:i.value.nssfTierIRate/100,nssfTierIIRate:i.value.nssfTierIIRate/100,vatRate:i.value.vatRate/100})}catch(a){console.error("Error saving settings:",a)}},o=()=>{s()};return(0,r.sV)(s),{form:i,errors:a,bracketErrors:t,taxStore:e,handleSubmit:l,resetForm:o}}},k=t(1241);const S=(0,k.A)(L,[["render",h],["__scopeId","data-v-516c8ee1"]]);var M=S}}]);
//# sourceMappingURL=421.f9e9cc47.js.map